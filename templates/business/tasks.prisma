// Module: Business Tasks
// Purpose: Task and work management models that complement projects and CRM workflows.

enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

model Task {
  id             String      @id @default(cuid())
  organizationId String
  projectId      String?
  parentTaskId   String?
  title          String
  description    String?
  status         TaskStatus  @default(BACKLOG)
  priority       TaskPriority @default(MEDIUM)
  dueDate        DateTime?
  startDate      DateTime?
  completedAt    DateTime?
  reporterUserId String?
  deletedAt      DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@index([organizationId, status])
  @@index([projectId])
}

model TaskAssignment {
  id          String   @id @default(cuid())
  taskId      String
  userId      String
  assignedAt  DateTime @default(now())
  unassignedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([taskId, userId])
  @@index([userId])
}

model TaskDependency {
  id             String   @id @default(cuid())
  taskId         String
  dependsOnTaskId String
  type           String   @default("finish_to_start")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([taskId, dependsOnTaskId])
  @@index([dependsOnTaskId])
}

model TaskComment {
  id          String   @id @default(cuid())
  taskId      String
  userId      String?
  body        String
  mentions    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([taskId])
}

// Integration:
// - Feeds engagement/notifications for mentions and reminders
// - Aligns with business/projects for cross-linked execution views
// Notes:
// - Soft delete tasks to keep audit history while hiding archived work
// - Use dependency type for CPM modelling without extra enum migrations
